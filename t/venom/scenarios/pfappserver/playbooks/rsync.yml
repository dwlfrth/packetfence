---
- hosts: pfservers, service_venom, nodes
  name: Rsync Git repository (localdev only)
  become: True

  tasks:
    - name: Synchronize Git repository t/venom with /usr/local/pf/t/venom
      ansible.posix.synchronize:
        # src is provided through test-wrapper.sh
        # as $PWD/venom (no leading slash)
        src: "{{ lookup('env', 'VENOM_ROOT_DIR') }}"
        dest: '/usr/local/pf/t/'
        archive: yes
        delete: yes
        # exclude files dynamically generated by Ansible
        rsync_opts:
          - "--exclude=vars/local.yml"

    - name: Synchronize Git repository t/html with /usr/local/pf/t/html
      ansible.posix.synchronize:
        # src is provided through test-wrapper.sh
        # as $PWD/venom (no leading slash)
        src: "{{ lookup('env', 'VENOM_ROOT_DIR') }}/../html"
        dest: '/usr/local/pf/t/'
        archive: yes
        delete: yes
        # exclude files dynamically generated by Ansible
        rsync_opts:
          - "--exclude=vars/local.yml"

    - name: Synchronize Git repository html/pfappserver/root with /usr/local/pf/html/pfappserver/root
      ansible.posix.synchronize:
        # src is provided through test-wrapper.sh
        # as $PWD/venom (no leading slash)
        src: "{{ lookup('env', 'VENOM_ROOT_DIR') }}/../../html/pfappserver/root"
        dest: '/usr/local/pf/html/pfappserver/'
        archive: yes
        delete: yes
        # exclude files dynamically generated by Ansible
        rsync_opts:
          - "--exclude=vars/local.yml"
